<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NExora - Crypto Profit Calculator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-orangered rounded-full flex items-center justify-center pulse-animation">
                        <span class="text-2xl">‚Çø</span>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-orangered">NExora</h1>
                        <p class="text-sm text-gray-400">Crypto Profit Calculator</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <div class="hidden sm:flex items-center space-x-2 text-sm">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-gray-400">Live Prices</span>
                    </div>
                    <button onclick="showTradeHistory()" class="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 sm:px-6 py-8">
        <!-- Calculator Section -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Input Panel -->
            <div class="lg:col-span-2">
                <div class="crypto-card rounded-2xl p-6 mb-6 fade-in">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <span class="text-2xl mr-3">üßÆ</span>
                        Profit Calculator
                    </h2>
                    
                    <!-- Token Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-3 text-orangered">Select Cryptocurrency</label>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3" id="token-grid">
                            <!-- Tokens will be populated here -->
                        </div>
                        
                        <!-- Custom token input -->
                        <div class="mt-4 flex space-x-3">
                            <input type="text" id="custom-token" placeholder="Enter token symbol (e.g., DOGE)" class="flex-1 p-3 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                            <button onclick="addCustomToken()" class="px-4 py-3 bg-orangered hover:bg-red-600 text-white rounded-lg transition-colors">
                                Add
                            </button>
                        </div>
                    </div>
                    
                    <!-- Price Inputs -->
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-orangered">Buy Price (USD)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="buy-price" placeholder="0.00" step="0.00000001" class="w-full p-3 pl-8 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                            </div>
                            <button onclick="useCurrentPrice('buy')" class="mt-2 text-sm text-orangered hover:text-red-400 transition-colors">
                                Use Current Price
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 text-orangered">Sell Price (USD)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="sell-price" placeholder="0.00" step="0.00000001" class="w-full p-3 pl-8 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                            </div>
                            <button onclick="useCurrentPrice('sell')" class="mt-2 text-sm text-orangered hover:text-red-400 transition-colors">
                                Use Current Price
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quantity Input -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2 text-orangered">Investment Amount</label>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-400">$</span>
                                    <input type="number" id="investment-usd" placeholder="0.00" step="0.01" class="w-full p-3 pl-8 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                                </div>
                                <p class="text-xs text-gray-400 mt-1">USD Amount</p>
                            </div>
                            
                            <div>
                                <input type="number" id="token-quantity" placeholder="0.00000000" step="0.00000001" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                                <p class="text-xs text-gray-400 mt-1">Token Quantity</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fees -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2 text-orangered">Trading Fees</label>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <input type="number" id="buy-fee" placeholder="0.1" step="0.01" value="0.1" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                                <p class="text-xs text-gray-400 mt-1">Buy Fee (%)</p>
                            </div>
                            
                            <div>
                                <input type="number" id="sell-fee" placeholder="0.1" step="0.01" value="0.1" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                                <p class="text-xs text-gray-400 mt-1">Sell Fee (%)</p>
                            </div>
                            
                            <div>
                                <select id="fee-preset" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg input-focus focus:outline-none">
                                    <option value="custom">Custom</option>
                                    <option value="binance">Binance (0.1%)</option>
                                    <option value="coinbase">Coinbase (0.5%)</option>
                                    <option value="kraken">Kraken (0.26%)</option>
                                    <option value="p2p">P2P (0%)</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-1">Fee Preset</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculate Button -->
                    <button onclick="calculateProfit()" class="w-full bg-orangered hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105">
                        üöÄ Calculate Profit
                    </button>
                </div>
                
                <!-- Live Prices -->
                <div class="crypto-card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold flex items-center">
                            <span class="text-2xl mr-3">üìä</span>
                            Live Market Prices
                        </h3>
                        <div class="flex items-center space-x-2 text-sm text-gray-400">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span id="last-update">Updated now</span>
                        </div>
                    </div>
                    
                    <div id="price-list" class="space-y-3 custom-scrollbar max-h-96 overflow-y-auto">
                        <!-- Live prices will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="space-y-6">
                <!-- Current Selection -->
                <div class="crypto-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3" id="selected-token-emoji">‚Çø</div>
                    <h3 class="text-xl font-bold mb-2" id="selected-token-name">Bitcoin</h3>
                    <div class="text-2xl font-bold mb-2" id="current-price">$0.00</div>
                    <div class="flex items-center justify-center space-x-2">
                        <span id="price-change" class="text-sm">0.00%</span>
                        <span class="text-xs text-gray-400">24h</span>
                    </div>
                </div>
                
                <!-- Profit Results -->
                <div class="crypto-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Profit Analysis</h3>
                    
                    <div class="space-y-4">
                        <div class="p-4 rounded-lg profit-neutral" id="profit-card">
                            <div class="text-center">
                                <div class="text-2xl font-bold mb-1" id="profit-amount">$0.00</div>
                                <div class="text-sm opacity-80" id="profit-percentage">0.00%</div>
                                <div class="text-xs opacity-60 mt-1" id="profit-status">Enter values to calculate</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-gray-800 rounded-lg p-3">
                                <div class="text-gray-400 mb-1">Investment</div>
                                <div class="font-semibold" id="total-investment">$0.00</div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-3">
                                <div class="text-gray-400 mb-1">Returns</div>
                                <div class="font-semibold" id="total-returns">$0.00</div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-3">
                                <div class="text-gray-400 mb-1">Total Fees</div>
                                <div class="font-semibold" id="total-fees">$0.00</div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-3">
                                <div class="text-gray-400 mb-1">Net Profit</div>
                                <div class="font-semibold" id="net-profit">$0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="crypto-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                    
                    <div class="space-y-3">
                        <button onclick="saveCalculation()" class="w-full p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            üíæ Save Calculation
                        </button>
                        
                        <button onclick="setAlert()" class="w-full p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                            üîî Set Price Alert
                        </button>
                        
                        <button onclick="clearAll()" class="w-full p-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                            üóëÔ∏è Clear All
                        </button>
                    </div>
                </div>
                
                <!-- Price Chart -->
                <div class="crypto-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Price Chart (24h)</h3>
                    <div class="chart-container">
                        <canvas id="price-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-gray-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-orangered">Trade History</h2>
                    <button onclick="closeTradeHistory()" class="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Token</th>
                                <th class="text-left p-3">Buy Price</th>
                                <th class="text-left p-3">Sell Price</th>
                                <th class="text-left p-3">Quantity</th>
                                <th class="text-left p-3">Profit/Loss</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="history-table">
                            <!-- Trade history will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 flex justify-between items-center">
                    <div class="text-sm text-gray-400">
                        Total Trades: <span id="total-trades">0</span>
                    </div>
                    <button onclick="exportHistory()" class="px-4 py-2 bg-orangered hover:bg-red-600 text-white rounded-lg transition-colors">
                        üìÑ Export CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedToken = 'bitcoin';
        let currentPrices = {};
        let priceChart = null;
        let tradeHistory = [];
        let priceUpdateInterval;
        
        // Popular cryptocurrencies
        const popularTokens = [
            { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', emoji: '‚Çø' },
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', emoji: '‚ü†' },
            { id: 'binancecoin', symbol: 'BNB', name: 'BNB', emoji: 'üü°' },
            { id: 'cardano', symbol: 'ADA', name: 'Cardano', emoji: 'üîµ' },
            { id: 'solana', symbol: 'SOL', name: 'Solana', emoji: 'üü£' },
            { id: 'ripple', symbol: 'XRP', name: 'XRP', emoji: 'üíß' },
            { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', emoji: 'üî¥' },
            { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin', emoji: 'üêï' },
            { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', emoji: 'üèîÔ∏è' },
            { id: 'chainlink', symbol: 'LINK', name: 'Chainlink', emoji: 'üîó' },
            { id: 'polygon', symbol: 'MATIC', name: 'Polygon', emoji: 'üü™' },
            { id: 'litecoin', symbol: 'LTC', name: 'Litecoin', emoji: 'ü•à' }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            renderTokenGrid();
            selectToken('bitcoin');
            startPriceUpdates();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Input event listeners
            document.getElementById('buy-price').addEventListener('input', calculateProfit);
            document.getElementById('sell-price').addEventListener('input', calculateProfit);
            document.getElementById('investment-usd').addEventListener('input', updateQuantityFromUSD);
            document.getElementById('token-quantity').addEventListener('input', updateUSDFromQuantity);
            document.getElementById('buy-fee').addEventListener('input', calculateProfit);
            document.getElementById('sell-fee').addEventListener('input', calculateProfit);
            
            // Fee preset selector
            document.getElementById('fee-preset').addEventListener('change', function() {
                const preset = this.value;
                const buyFeeInput = document.getElementById('buy-fee');
                const sellFeeInput = document.getElementById('sell-fee');
                
                switch(preset) {
                    case 'binance':
                        buyFeeInput.value = '0.1';
                        sellFeeInput.value = '0.1';
                        break;
                    case 'coinbase':
                        buyFeeInput.value = '0.5';
                        sellFeeInput.value = '0.5';
                        break;
                    case 'kraken':
                        buyFeeInput.value = '0.26';
                        sellFeeInput.value = '0.26';
                        break;
                    case 'p2p':
                        buyFeeInput.value = '0';
                        sellFeeInput.value = '0';
                        break;
                }
                calculateProfit();
            });
        }

        // Render token selection grid
        function renderTokenGrid() {
            const grid = document.getElementById('token-grid');
            grid.innerHTML = popularTokens.map(token => `
                <button onclick="selectToken('${token.id}')" class="token-option p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-all text-center ${selectedToken === token.id ? 'token-selected' : ''}">
                    <div class="text-2xl mb-1">${token.emoji}</div>
                    <div class="font-semibold text-sm">${token.symbol}</div>
                    <div class="text-xs text-gray-400">${token.name}</div>
                </button>
            `).join('');
        }

        // Select token
        function selectToken(tokenId) {
            selectedToken = tokenId;
            const token = popularTokens.find(t => t.id === tokenId);
            
            if (token) {
                document.getElementById('selected-token-emoji').textContent = token.emoji;
                document.getElementById('selected-token-name').textContent = token.name;
                
                // Update UI
                renderTokenGrid();
                updateCurrentPrice();
                calculateProfit();
            }
        }

        // Add custom token
        function addCustomToken() {
            const customInput = document.getElementById('custom-token');
            const symbol = customInput.value.toUpperCase().trim();
            
            if (!symbol) {
                showNotification('Please enter a token symbol', 'error');
                return;
            }
            
            // Try to fetch price for custom token
            fetchCustomTokenPrice(symbol);
            customInput.value = '';
        }

        // Fetch custom token price
        async function fetchCustomTokenPrice(symbol) {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/search?query=${symbol}`);
                const data = await response.json();
                
                if (data.coins && data.coins.length > 0) {
                    const coin = data.coins[0];
                    const customToken = {
                        id: coin.id,
                        symbol: symbol,
                        name: coin.name,
                        emoji: 'ü™ô'
                    };
                    
                    popularTokens.push(customToken);
                    renderTokenGrid();
                    selectToken(coin.id);
                    showNotification(`Added ${symbol} successfully!`, 'success');
                } else {
                    showNotification(`Token ${symbol} not found`, 'error');
                }
            } catch (error) {
                showNotification('Error fetching token data', 'error');
            }
        }

        // Start price updates
        function startPriceUpdates() {
            fetchPrices();
            priceUpdateInterval = setInterval(fetchPrices, 30000); // Update every 30 seconds
        }

        // Fetch live prices
        async function fetchPrices() {
            try {
                const tokenIds = popularTokens.map(t => t.id).join(',');
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${tokenIds}&vs_currencies=usd&include_24hr_change=true`);
                const data = await response.json();
                
                currentPrices = data;
                updatePriceDisplay();
                updateCurrentPrice();
                updateLastUpdateTime();
                
                // Animate price updates
                document.querySelectorAll('.price-item').forEach(item => {
                    item.classList.add('price-update');
                    setTimeout(() => item.classList.remove('price-update'), 1000);
                });
                
            } catch (error) {
                console.error('Error fetching prices:', error);
                showNotification('Failed to update prices', 'error');
            }
        }

        // Update price display
        function updatePriceDisplay() {
            const priceList = document.getElementById('price-list');
            
            priceList.innerHTML = popularTokens.map(token => {
                const priceData = currentPrices[token.id];
                if (!priceData) return '';
                
                const price = priceData.usd;
                const change = priceData.usd_24h_change || 0;
                const changeClass = change > 0 ? 'price-up' : change < 0 ? 'price-down' : 'price-neutral';
                const changeIcon = change > 0 ? 'üìà' : change < 0 ? 'üìâ' : '‚û°Ô∏è';
                
                return `
                    <div class="price-item flex items-center justify-between p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer" onclick="selectToken('${token.id}')">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${token.emoji}</span>
                            <div>
                                <div class="font-semibold">${token.symbol}</div>
                                <div class="text-xs text-gray-400">${token.name}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold">$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })}</div>
                            <div class="text-xs ${changeClass} flex items-center space-x-1">
                                <span>${changeIcon}</span>
                                <span>${change.toFixed(2)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update current price display
        function updateCurrentPrice() {
            const priceData = currentPrices[selectedToken];
            if (priceData) {
                const price = priceData.usd;
                const change = priceData.usd_24h_change || 0;
                const changeClass = change > 0 ? 'price-up' : change < 0 ? 'price-down' : 'price-neutral';
                
                document.getElementById('current-price').textContent = `$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })}`;
                document.getElementById('price-change').textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
                document.getElementById('price-change').className = `text-sm ${changeClass}`;
            }
        }

        // Update last update time
        function updateLastUpdateTime() {
            document.getElementById('last-update').textContent = 'Updated now';
        }

        // Use current price
        function useCurrentPrice(type) {
            const priceData = currentPrices[selectedToken];
            if (priceData) {
                const price = priceData.usd;
                if (type === 'buy') {
                    document.getElementById('buy-price').value = price;
                } else {
                    document.getElementById('sell-price').value = price;
                }
                calculateProfit();
            } else {
                showNotification('Price data not available', 'error');
            }
        }

        // Update quantity from USD
        function updateQuantityFromUSD() {
            const usdAmount = parseFloat(document.getElementById('investment-usd').value) || 0;
            const buyPrice = parseFloat(document.getElementById('buy-price').value) || 0;
            
            if (buyPrice > 0) {
                const quantity = usdAmount / buyPrice;
                document.getElementById('token-quantity').value = quantity.toFixed(8);
            }
            
            calculateProfit();
        }

        // Update USD from quantity
        function updateUSDFromQuantity() {
            const quantity = parseFloat(document.getElementById('token-quantity').value) || 0;
            const buyPrice = parseFloat(document.getElementById('buy-price').value) || 0;
            
            if (buyPrice > 0) {
                const usdAmount = quantity * buyPrice;
                document.getElementById('investment-usd').value = usdAmount.toFixed(2);
            }
            
            calculateProfit();
        }

        // Calculate profit
        function calculateProfit() {
            const buyPrice = parseFloat(document.getElementById('buy-price').value) || 0;
            const sellPrice = parseFloat(document.getElementById('sell-price').value) || 0;
            const quantity = parseFloat(document.getElementById('token-quantity').value) || 0;
            const buyFee = parseFloat(document.getElementById('buy-fee').value) || 0;
            const sellFee = parseFloat(document.getElementById('sell-fee').value) || 0;
            
            if (buyPrice <= 0 || sellPrice <= 0 || quantity <= 0) {
                resetResults();
                return;
            }
            
            // Calculate investment and returns
            const investment = quantity * buyPrice;
            const returns = quantity * sellPrice;
            
            // Calculate fees
            const buyFeeAmount = investment * (buyFee / 100);
            const sellFeeAmount = returns * (sellFee / 100);
            const totalFees = buyFeeAmount + sellFeeAmount;
            
            // Calculate profit/loss
            const grossProfit = returns - investment;
            const netProfit = grossProfit - totalFees;
            const profitPercentage = (netProfit / (investment + buyFeeAmount)) * 100;
            
            // Update UI
            updateResults({
                investment: investment + buyFeeAmount,
                returns: returns - sellFeeAmount,
                totalFees,
                netProfit,
                profitPercentage
            });
        }

        // Update results display
        function updateResults(results) {
            const { investment, returns, totalFees, netProfit, profitPercentage } = results;
            
            // Update profit card
            const profitCard = document.getElementById('profit-card');
            const profitAmount = document.getElementById('profit-amount');
            const profitPercentageEl = document.getElementById('profit-percentage');
            const profitStatus = document.getElementById('profit-status');
            
            profitAmount.textContent = `$${netProfit.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            profitPercentageEl.textContent = `${profitPercentage > 0 ? '+' : ''}${profitPercentage.toFixed(2)}%`;
            
            if (netProfit > 0) {
                profitCard.className = 'p-4 rounded-lg profit-positive';
                profitStatus.textContent = 'üöÄ Profitable Trade';
            } else if (netProfit < 0) {
                profitCard.className = 'p-4 rounded-lg profit-negative';
                profitStatus.textContent = 'üìâ Loss Trade';
            } else {
                profitCard.className = 'p-4 rounded-lg profit-neutral';
                profitStatus.textContent = '‚û°Ô∏è Break Even';
            }
            
            // Update details
            document.getElementById('total-investment').textContent = `$${investment.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('total-returns').textContent = `$${returns.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('total-fees').textContent = `$${totalFees.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('net-profit').textContent = `$${netProfit.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            
            // Add animation
            profitAmount.classList.add('count-up');
            setTimeout(() => profitAmount.classList.remove('count-up'), 500);
        }

        // Reset results
        function resetResults() {
            document.getElementById('profit-card').className = 'p-4 rounded-lg profit-neutral';
            document.getElementById('profit-amount').textContent = '$0.00';
            document.getElementById('profit-percentage').textContent = '0.00%';
            document.getElementById('profit-status').textContent = 'Enter values to calculate';
            document.getElementById('total-investment').textContent = '$0.00';
            document.getElementById('total-returns').textContent = '$0.00';
            document.getElementById('total-fees').textContent = '$0.00';
            document.getElementById('net-profit').textContent = '$0.00';
        }

        // Save calculation
        function saveCalculation() {
            const buyPrice = parseFloat(document.getElementById('buy-price').value) || 0;
            const sellPrice = parseFloat(document.getElementById('sell-price').value) || 0;
            const quantity = parseFloat(document.getElementById('token-quantity').value) || 0;
            
            if (buyPrice <= 0 || sellPrice <= 0 || quantity <= 0) {
                showNotification('Please enter valid values first', 'error');
                return;
            }
            
            const token = popularTokens.find(t => t.id === selectedToken);
            const netProfit = parseFloat(document.getElementById('net-profit').textContent.replace(/[$,]/g, ''));
            
            const trade = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                token: token.symbol,
                tokenName: token.name,
                buyPrice,
                sellPrice,
                quantity,
                profit: netProfit,
                profitPercentage: ((sellPrice - buyPrice) / buyPrice * 100).toFixed(2)
            };
            
            tradeHistory.unshift(trade);
            saveData();
            showNotification('Calculation saved!', 'success');
        }

        // Set price alert
        function setAlert() {
            const targetPrice = prompt('Enter target price for ' + popularTokens.find(t => t.id === selectedToken)?.symbol + ':');
            if (targetPrice && !isNaN(targetPrice)) {
                showNotification(`Price alert set for $${parseFloat(targetPrice).toFixed(2)}`, 'success');
                // In a real app, this would set up a proper alert system
            }
        }

        // Clear all inputs
        function clearAll() {
            document.getElementById('buy-price').value = '';
            document.getElementById('sell-price').value = '';
            document.getElementById('investment-usd').value = '';
            document.getElementById('token-quantity').value = '';
            resetResults();
        }

        // Show trade history
        function showTradeHistory() {
            updateTradeHistoryTable();
            document.getElementById('history-modal').classList.remove('hidden');
        }

        // Close trade history
        function closeTradeHistory() {
            document.getElementById('history-modal').classList.add('hidden');
        }

        // Update trade history table
        function updateTradeHistoryTable() {
            const table = document.getElementById('history-table');
            const totalTrades = document.getElementById('total-trades');
            
            totalTrades.textContent = tradeHistory.length;
            
            if (tradeHistory.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8 text-gray-400">
                            No trade history yet. Save some calculations to see them here!
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = tradeHistory.map(trade => `
                <tr class="trade-row border-b border-gray-800">
                    <td class="p-3">${trade.date}</td>
                    <td class="p-3">${trade.token}</td>
                    <td class="p-3">$${trade.buyPrice.toFixed(8)}</td>
                    <td class="p-3">$${trade.sellPrice.toFixed(8)}</td>
                    <td class="p-3">${trade.quantity.toFixed(8)}</td>
                    <td class="p-3">
                        <span class="${trade.profit >= 0 ? 'text-green-400' : 'text-red-400'}">
                            $${trade.profit.toFixed(2)} (${trade.profitPercentage}%)
                        </span>
                    </td>
                    <td class="p-3">
                        <button onclick="deleteTrade(${trade.id})" class="text-red-400 hover:text-red-300 transition-colors">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Delete trade
        function deleteTrade(tradeId) {
            tradeHistory = tradeHistory.filter(trade => trade.id !== tradeId);
            updateTradeHistoryTable();
            saveData();
            showNotification('Trade deleted', 'info');
        }

        // Export history
        function exportHistory() {
            if (tradeHistory.length === 0) {
                showNotification('No trade history to export', 'error');
                return;
            }
            
            const csv = [
                ['Date', 'Token', 'Buy Price', 'Sell Price', 'Quantity', 'Profit', 'Profit %'],
                ...tradeHistory.map(trade => [
                    trade.date,
                    trade.token,
                    trade.buyPrice,
                    trade.sellPrice,
                    trade.quantity,
                    trade.profit,
                    trade.profitPercentage + '%'
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nexora-trade-history.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Trade history exported!', 'success');
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'info' ? 'bg-blue-600' : 'bg-gray-600'
            }`;
            
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            notification.innerHTML = `<div class="flex items-center space-x-2"><span>${icon}</span><span>${message}</span></div>`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('nexora-crypto-trades', JSON.stringify(tradeHistory));
            localStorage.setItem('nexora-selected-token', selectedToken);
        }

        function loadSavedData() {
            const savedTrades = localStorage.getItem('nexora-crypto-trades');
            const savedToken = localStorage.getItem('nexora-selected-token');
            
            if (savedTrades) {
                tradeHistory = JSON.parse(savedTrades);
            }
            
            if (savedToken) {
                selectedToken = savedToken;
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'968c2fb31704d14d',t:'MTc1NDEyMzE0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>